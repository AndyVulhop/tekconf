@using System.Configuration
@using System.Web.Optimization
@model List<TekConf.RemoteData.Dtos.v1.ConferencesDto>

@{
	Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">

	<title>Conferences - tekconf</title>
	<link rel="shortcut icon" type="image/x-icon" href="~/favicon.ico">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">

	<link href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,400,600" rel="stylesheet">

	@Styles.Render("~/css/conferences/index")
	<link href="~/Content/themes/base/jquery-ui.css" rel="stylesheet" />
	<link href="~/Content/themes/base/jquery.ui.autocomplete.css" rel="stylesheet" />
	<style>
		.ui-autocomplete-loading {
			background: white url('images/ui-anim_basic_16x16.gif') right center no-repeat;
		}
	</style>
	<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
	<!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

	<!-- API NOTE : This page is generated by calling http://api.tekconf.com/v1/conferences -->
</head>

<body>
	@Html.Partial("Header")

	<div id="subheader">
		<div class="inner">
			<div class="container">
				<h1>Conferences</h1>
			</div>
			<!-- /.container -->
		</div>
		<!-- /inner -->
	</div>
	<!-- /subheader -->

	<div id="subpage">
		<div class="container">
			<div class="row">

				@using (Html.BeginForm())
		{
			var views = new List<SelectListItem>() {
                                    new SelectListItem(){Text = "Thumbnails",Value = "thumbnails",Selected = !ViewBag.ShowTable},
                                    new SelectListItem(){Text = "Table", Value = "table", Selected = ViewBag.ShowTable}
                    };
                    
					<div class="span2">
						@Html.DropDownList("viewAs", views, new { @onchange = "this.form.submit();", style = "width:120px;" })
					</div>
			var sorts = new List<SelectListItem>()
                            {
                                new SelectListItem() {Text = "Start Date", Value = "startDate"},
                                new SelectListItem() {Text = "Name", Value = "name"},
                                new SelectListItem() {Text = "Call for Speakers Opening", Value = "callForSpeakersOpeningDate"},
                                new SelectListItem() {Text = "Call for Speakers Closing", Value = "callForSpeakersClosingDate"},
                                new SelectListItem() {Text = "Tickets on Sale Date", Value = "registrationOpens"},
                                new SelectListItem() {Text = "Date Added", Value = "dateAdded"}
                            
                    };
                    
					<div class="span3 sortBy">
						@Html.DropDownList("sortBy", sorts, new { @onchange = "this.form.submit();" })
					</div>
					<div class="span2 showPastConferences">
						<text>&nbsp;&nbsp;</text>@Html.CheckBox("showPastConferences", new { @onchange = "this.form.submit();" })<text> Show Past Conferences?</text>
					</div>
                    
					<div class="span5 searchBox input-append ui-widget">

						@Html.TextBox("search", null, new { @class = "span2 search-query" })
						<button class="btn" onclick="this.form.submit()" id="searchButton" style="margin-right: 30px;">Search</button>
					</div>
		}
			</div>

			<div class="row">
				@if (ViewBag.ShowTable)
		{
					<div class="span12">
						<table class="table">
							<tbody>
								@foreach (var conference in Model)
				{
									<tr>
										<td><a href="~/Conferences/@conference.slug" class="btn btn-primary btn-mini">View Conference</a></td>
										<td>@conference.name</td>
										<td>@HtmlHelpers.FormatDateRange(conference.start, conference.end)</td>
										<td>@HtmlHelpers.FormatAddress(conference.address)</td>
									</tr>
				}
							</tbody>
						</table>
					</div>
		}
		else
		{
					<ul class="thumbnails">

						@if (Model != null)
			{
				foreach (var conference in Model)
				{
                            
							<li class="span3">

								<div class="thumbnail" style="height: 590px; position: relative;">
									@if (conference.IsOnSale())
				 {
										<img src="~/img/OnSale.png" class="overlay overlay-onsale" />
				 }
									<img src="@conference.imageUrl" alt="@conference.name">
									@if (conference.IsOpenCallForSpeakers())
									{
										<img src="~/img/OpenCall.png" class="overlay overlay-opencall overlay-right" />
									}
									<div class="caption">
										<h3>@conference.name</h3>
										<h4>@HtmlHelpers.FormatDateRange(conference.start, conference.end)<br />@conference.location</h4>
										<p style="">
											@conference.description
										</p>
										<p><strong>@conference.numberOfSessions Sessions</strong></p>
										<div style="position: absolute; bottom: 10px;">
											<a href="~/Conferences/@conference.slug" class="btn btn-primary">View Conference</a> <a href="#" class="btn">I'm Attending!</a>
										</div>
									</div>
								</div>
							</li>
				}
			}
					</ul>
		}



			</div>

		</div>
		<!-- /container -->

	</div>
	<!-- /subpage -->

	@Html.Partial("Extra")

	@Html.Partial("Footer")

	@Scripts.Render("~/js/common")

	<script type="text/javascript" language="javascript">
		$(function () {

			$("#search").autocomplete({
				messages: {
					noResults: null,
					results: function () { }
				},
				source: function (request, response) {
					$.ajax({
						url: '@(ConfigurationManager.AppSettings["BaseUrl"])/v1/conferences/search?searchTerm=' + request.term + '&showPastConferences=' + $('#showPastConferences').is(':checked') + '&format=json',
						dataType: "jsonp",
						data: request,
						success: function (data) {
							response($.map(data, function (item) {
								return {
									label: item.label,
									value: item.value
								}
							}));
						}
					});
				},
				minLength: 2,
				select: function (event, ui) {
					this.value = ui.item.value;
					$('#searchButton').click();
				},
				open: function () {
					$(this).removeClass("ui-corner-all").addClass("ui-corner-top");
				},
				close: function () {
					$(this).removeClass("ui-corner-top").addClass("ui-corner-all");
				}
			});



		});
	</script>
</body>
</html>
